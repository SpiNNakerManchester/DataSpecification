
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>data_specification.data_specification_generator &#8212; DataSpecification 6.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxdoc.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">DataSpecification 6.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">data_specification.data_specification_generator</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for data_specification.data_specification_generator</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2017-2019 The University of Manchester</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">IntEnum</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">spinn_utilities.log</span> <span class="kn">import</span> <span class="n">FormatAdapter</span>
<span class="kn">from</span> <span class="nn">spinn_machine</span> <span class="kn">import</span> <span class="n">sdram</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MAX_CONSTRUCTORS</span><span class="p">,</span> <span class="n">MAX_MEM_REGIONS</span><span class="p">,</span> <span class="n">MAX_RANDOM_DISTS</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">,</span>
    <span class="n">MAX_RNGS</span><span class="p">,</span> <span class="n">MAX_STRUCT_ELEMENTS</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">,</span> <span class="n">LEN1</span><span class="p">,</span> <span class="n">LEN2</span><span class="p">,</span> <span class="n">LEN3</span><span class="p">,</span> <span class="n">LEN4</span><span class="p">,</span>
    <span class="n">NO_REGS</span><span class="p">,</span> <span class="n">DEST_AND_SRC1</span><span class="p">,</span> <span class="n">DEST_ONLY</span><span class="p">,</span> <span class="n">SRC1_ONLY</span><span class="p">,</span> <span class="n">SRC1_AND_SRC2</span><span class="p">,</span>
    <span class="n">BYTES_PER_WORD</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DataUndefinedWriterException</span><span class="p">,</span> <span class="n">DuplicateParameterException</span><span class="p">,</span>
    <span class="n">FunctionInUseException</span><span class="p">,</span> <span class="n">InvalidCommandException</span><span class="p">,</span>
    <span class="n">InvalidOperationException</span><span class="p">,</span> <span class="n">InvalidSizeException</span><span class="p">,</span> <span class="n">NotAllocatedException</span><span class="p">,</span>
    <span class="n">NoRegionSelectedException</span><span class="p">,</span> <span class="n">ParameterOutOfBoundsException</span><span class="p">,</span>
    <span class="n">RandomNumberDistributionInUseException</span><span class="p">,</span> <span class="n">RegionInUseException</span><span class="p">,</span>
    <span class="n">RegionUnfilledException</span><span class="p">,</span> <span class="n">RNGInUseException</span><span class="p">,</span> <span class="n">StructureInUseException</span><span class="p">,</span>
    <span class="n">TypeMismatchException</span><span class="p">,</span> <span class="n">UnknownConditionException</span><span class="p">,</span> <span class="n">UnknownTypeException</span><span class="p">,</span>
    <span class="n">UnknownTypeLengthException</span><span class="p">,</span> <span class="n">WrongParameterNumberException</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.enums</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DataType</span><span class="p">,</span> <span class="n">RandomNumberGenerator</span><span class="p">,</span> <span class="n">Commands</span><span class="p">,</span> <span class="n">Condition</span><span class="p">,</span> <span class="n">LogicOperation</span><span class="p">,</span>
    <span class="n">ArithmeticOperation</span><span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">FormatAdapter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>
<span class="n">_ONE_SBYTE</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;b&quot;</span><span class="p">)</span>
<span class="n">_ONE_WORD</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">)</span>
<span class="n">_ONE_SIGNED_INT</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">)</span>
<span class="n">_TWO_WORDS</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;II&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_bounds</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A simple bounds checker.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">low</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">high</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterOutOfBoundsException</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmd</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_typebounds</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A simple bounds checker that uses the bounds from a type descriptor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">valuetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DataType</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UnknownTypeException</span><span class="p">(</span><span class="n">valuetype</span><span class="p">,</span> <span class="n">cmd</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">valuetype</span><span class="o">.</span><span class="n">min</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">valuetype</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterOutOfBoundsException</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">valuetype</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">valuetype</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">cmd</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_Field</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Various shifts for fields used with :py:func:`_binencode`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">28</span>
    <span class="n">COMMAND</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">SIGNED</span> <span class="o">=</span> <span class="mi">19</span>
    <span class="n">USAGE</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">DESTINATION</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">SOURCE_1</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">EMPTY</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">REFERENCEABLE</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">SOURCE_2</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">IMMEDIATE</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">_binencode</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Encodes commands as binary words.</span>

<span class="sd">    :param Commands command: The code of the command being encoded.</span>
<span class="sd">    :param arguments: How to parameterise the command.</span>
<span class="sd">    :type arguments: dict(:py:class:`_Field`,int)</span>
<span class="sd">    :return: the encoded command</span>
<span class="sd">    :rtype: bytearray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">_Field</span><span class="o">.</span><span class="n">COMMAND</span>
    <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">shift</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">shift</span> <span class="o">&gt;</span> <span class="mi">31</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">()</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="n">shift</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">cmd_word</span> <span class="o">|=</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span>
    <span class="k">return</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">_MemSlot</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Metadata for a memory region.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="s2">&quot;empty&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">empty</span><span class="p">):</span>
        <span class="c1">#: Optional label for the region; str or None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="c1"># round size to a number of words</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">%</span> <span class="n">BYTES_PER_WORD</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">+</span> <span class="p">(</span><span class="n">BYTES_PER_WORD</span> <span class="o">-</span> <span class="p">(</span><span class="n">size</span> <span class="o">%</span> <span class="n">BYTES_PER_WORD</span><span class="p">))</span>
        <span class="c1">#: The size of the region; int</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="c1">#: Whether the region is to be left empty; bool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">empty</span> <span class="o">=</span> <span class="n">empty</span>


<div class="viewcode-block" id="DataSpecificationGenerator"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator">[docs]</a><span class="k">class</span> <span class="nc">DataSpecificationGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Used to generate a SpiNNaker data specification language file that\</span>
<span class="sd">        can be executed to produce a memory image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=too-many-arguments</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;_spec_writer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_report_writer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_txt_indent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_instruction_counter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_mem_slots&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_function_slots&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_struct_slots&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_rng&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_random_distribution&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_conditionals&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_current_region&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_ongoing_function_definition&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_ongoing_loop&quot;</span>
    <span class="p">]</span>

<div class="viewcode-block" id="DataSpecificationGenerator.__init__"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec_writer</span><span class="p">,</span> <span class="n">report_writer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param ~io.RawIOBase spec_writer:</span>
<span class="sd">            The object to write the specification to</span>
<span class="sd">        :param report_writer:</span>
<span class="sd">            Determines if a text version of the specification is to be</span>
<span class="sd">            written and, if so, where. No report is written if this is None.</span>
<span class="sd">        :type report_writer: ~io.TextIOBase or None</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec_writer</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">RawIOBase</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;spec_writer must be a RawIOBase&quot;</span><span class="p">)</span>
        <span class="c1">#: The object to write the specification to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spec_writer</span> <span class="o">=</span> <span class="n">spec_writer</span>
        <span class="k">if</span> <span class="n">report_writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">report_writer</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOBase</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;report_writer must be a TextIOBase or None&quot;</span><span class="p">)</span>
        <span class="c1">#: the writer for the human readable report</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_writer</span> <span class="o">=</span> <span class="n">report_writer</span>
        <span class="c1">#: current indentation for the report writer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txt_indent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: instruction counter, for the report writer only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instruction_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: the memory regions; list(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">MAX_MEM_REGIONS</span>
        <span class="c1">#: the functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function_slots</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">MAX_CONSTRUCTORS</span>
        <span class="c1">#: the structure definitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">MAX_STRUCT_SLOTS</span>
        <span class="c1">#: the random number generators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">MAX_RNGS</span>
        <span class="c1">#: the random distributions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_distribution</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">MAX_RANDOM_DISTS</span>
        <span class="c1">#: stack of _conditionals, used for &#39;else&#39; tracking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conditionals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: the current DSG region we&#39;re writing to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: whether there is a currently-being-made function definition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ongoing_function_definition</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: whether there is a currently executing loop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ongoing_loop</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.comment"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.comment">[docs]</a>    <span class="k">def</span> <span class="nf">comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Write a comment to the text version of the specification.\</span>
<span class="sd">            Note that this is ignored by the binary file</span>

<span class="sd">        :param str comment: The comment to write</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span>
            <span class="nb">bytearray</span><span class="p">(),</span> <span class="n">comment</span><span class="p">,</span> <span class="n">no_instruction_number</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.define_break"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.define_break">[docs]</a>    <span class="k">def</span> <span class="nf">define_break</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to stop execution with an exception (for debugging)</span>

<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">BREAK</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">BREAK</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.no_operation"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.no_operation">[docs]</a>    <span class="k">def</span> <span class="nf">no_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to execute nothing</span>

<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">NOP</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">NOP</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.reserve_memory_region"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.reserve_memory_region">[docs]</a>    <span class="k">def</span> <span class="nf">reserve_memory_region</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">empty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to reserve a memory region</span>

<span class="sd">        :param int region: The number of the region to reserve, from 0 to 15</span>
<span class="sd">        :param int size: The size to reserve for the region, in bytes</span>
<span class="sd">        :param label: An optional label for the region</span>
<span class="sd">        :type label: str or None</span>
<span class="sd">        :param bool empty: Specifies if the region will be left empty</span>
<span class="sd">        :param reference: A globally unique reference for this region</span>
<span class="sd">        :type reference: int or None</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise RegionInUseException: If the ``region`` was already reserved</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            If the ``region`` requested was out of the allowed range, or the</span>
<span class="sd">            ``size`` was too big to fit in SDRAM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">RESERVE</span><span class="p">,</span> <span class="s2">&quot;memory region identifier&quot;</span><span class="p">,</span>
                <span class="n">region</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_MEM_REGIONS</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">RESERVE</span><span class="p">,</span> <span class="s2">&quot;memory size&quot;</span><span class="p">,</span>
                <span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sdram</span><span class="o">.</span><span class="n">SDRAM</span><span class="o">.</span><span class="n">max_sdram_found</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RegionInUseException</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MemSlot</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">empty</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">RESERVE</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN2</span> <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">LEN3</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">NO_REGS</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">empty</span><span class="p">),</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">REFERENCEABLE</span><span class="p">:</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">region</span><span class="p">})</span>
        <span class="n">encoded_size</span> <span class="o">=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">encoded_ref</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">encoded_ref</span> <span class="o">=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">RESERVE</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; memRegion=</span><span class="si">{0:d}</span><span class="s2"> size=</span><span class="si">{1:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; label=&#39;</span><span class="si">{0:s}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">empty</span><span class="p">:</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; UNFILLED&quot;</span>
        <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; REF </span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span>
            <span class="n">cmd_word</span> <span class="o">+</span> <span class="n">encoded_size</span> <span class="o">+</span> <span class="n">encoded_ref</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.reference_memory_region"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.reference_memory_region">[docs]</a>    <span class="k">def</span> <span class="nf">reference_memory_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to reference another memory region</span>

<span class="sd">        :param int region: The number of the region to reserve, from 0 to 15</span>
<span class="sd">        :param int ref: The identifier of the region to reference</span>
<span class="sd">        :param label: An optional label for the region</span>
<span class="sd">        :type label: str or None</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise RegionInUseException: If the ``region`` was already reserved</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            If the ``region`` requested was out of the allowed range, or the</span>
<span class="sd">            ``size`` was too big to fit in SDRAM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">REFERENCE</span><span class="p">,</span> <span class="s2">&quot;memory region identifier&quot;</span><span class="p">,</span>
                <span class="n">region</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_MEM_REGIONS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RegionInUseException</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MemSlot</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">REFERENCE</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN2</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">region</span><span class="p">})</span>
        <span class="n">encoded_args</span> <span class="o">=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">REFERENCE</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; memRegion=</span><span class="si">{0:d}</span><span class="s2"> ref=</span><span class="si">{1:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; label=&#39;</span><span class="si">{0:s}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">encoded_args</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.free_memory_region"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.free_memory_region">[docs]</a>    <span class="k">def</span> <span class="nf">free_memory_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to free a previously reserved memory region</span>

<span class="sd">        :param int region: The number of the region to free, from 0 to 15</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise NotAllocatedException: If the region was not reserved</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            If the ``region`` requested was out of the allowed range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">FREE</span><span class="p">,</span> <span class="s2">&quot;memory region identifier&quot;</span><span class="p">,</span>
                <span class="n">region</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_MEM_REGIONS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">FREE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span><span class="o">.</span><span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">FREE</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">NO_REGS</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">region</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">FREE</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; memRegion=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; (</span><span class="si">{0:s}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.declare_random_number_generator"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.declare_random_number_generator">[docs]</a>    <span class="k">def</span> <span class="nf">declare_random_number_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng_id</span><span class="p">,</span> <span class="n">rng_type</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to declare a random number generator</span>

<span class="sd">        :param int rng_id: The ID of the random number generator</span>
<span class="sd">        :param RandomNumberGenerator rng_type:</span>
<span class="sd">            The type of the random number generator</span>
<span class="sd">        :param int seed: The seed of the random number generator &gt;= 0</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise UnknownTypeException:</span>
<span class="sd">            If the ``rng_type`` is not one of the allowed values</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If the ``seed`` is too big or too small</span>
<span class="sd">            * If the ``rng_id`` is not in the allowed range</span>
<span class="sd">        :raise RNGInUseException:</span>
<span class="sd">            If the random number generator with the given ID has already been</span>
<span class="sd">            defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RNG</span><span class="p">,</span> <span class="s2">&quot;random number generator ID&quot;</span><span class="p">,</span>
                <span class="n">rng_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_RNGS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rng_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RandomNumberGenerator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnknownTypeException</span><span class="p">(</span>
                <span class="n">rng_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RNG</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">[</span><span class="n">rng_id</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RNGInUseException</span><span class="p">(</span><span class="n">rng_id</span><span class="p">)</span>
        <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RNG</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">[</span><span class="n">rng_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rng_type</span><span class="p">,</span> <span class="n">seed</span><span class="p">]</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RNG</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN2</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">rng_id</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">rng_type</span><span class="p">})</span>
        <span class="n">encoded_seed</span> <span class="o">=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RNG</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; ID=</span><span class="si">{0:d}</span><span class="s2">, source=</span><span class="si">{1:d}</span><span class="s2">, seed=</span><span class="si">{2:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">rng_id</span><span class="p">,</span> <span class="n">rng_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">encoded_seed</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.declare_uniform_random_distribution"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.declare_uniform_random_distribution">[docs]</a>    <span class="k">def</span> <span class="nf">declare_uniform_random_distribution</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">distribution_id</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">,</span> <span class="n">rng_id</span><span class="p">,</span> <span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert commands to declare a uniform random distribution</span>

<span class="sd">        :param int distribution_id: ID of the distribution being set up</span>
<span class="sd">        :param int structure_id: ID of an empty structure slot to fill with</span>
<span class="sd">            the uniform random distribution data</span>
<span class="sd">        :param int rng_id:</span>
<span class="sd">            The ID of the random number generator, between 0 and 15</span>
<span class="sd">        :param float min_value: The minimum value that should be returned from</span>
<span class="sd">            the distribution between -32768.0 and max_value</span>
<span class="sd">        :param float max_value: The maximum value that should be returned from</span>
<span class="sd">            the distribution between min_value and 32767.9999847</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise NoMoreException:</span>
<span class="sd">            If there is no more space for a new random distribution</span>
<span class="sd">        :raise NotAllocatedException:</span>
<span class="sd">            If the requested ``rng_id`` has not been allocated</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            If ``rng_id``, ``structure_id``, ``min_value`` or ``max_value`` is</span>
<span class="sd">            out of range</span>
<span class="sd">        :raise StructureInUseException:</span>
<span class="sd">            If structure ``structure_id`` is already defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RANDOM_DIST</span><span class="p">,</span> <span class="s2">&quot;distribution ID&quot;</span><span class="p">,</span>
                <span class="n">distribution_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_RANDOM_DISTS</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RANDOM_DIST</span><span class="p">,</span> <span class="s2">&quot;rng ID&quot;</span><span class="p">,</span>
                <span class="n">rng_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_RNGS</span><span class="p">)</span>
        <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RANDOM_DIST</span><span class="p">,</span> <span class="s2">&quot;min_value&quot;</span><span class="p">,</span>
                    <span class="n">min_value</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">S1615</span><span class="p">)</span>
        <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RANDOM_DIST</span><span class="p">,</span> <span class="s2">&quot;max_value&quot;</span><span class="p">,</span>
                    <span class="n">max_value</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">S1615</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RANDOM_DIST</span><span class="p">,</span> <span class="s2">&quot;structure ID&quot;</span><span class="p">,</span>
                <span class="n">structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">[</span><span class="n">rng_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;RNG&quot;</span><span class="p">,</span> <span class="n">rng_id</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RANDOM_DIST</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_distribution</span><span class="p">[</span><span class="n">distribution_id</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RandomNumberDistributionInUseException</span><span class="p">(</span><span class="n">distribution_id</span><span class="p">)</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;distType&quot;</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot;rngID&quot;</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">,</span> <span class="n">rng_id</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot;param1&quot;</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">S1615</span><span class="p">,</span> <span class="n">min_value</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot;param2&quot;</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">S1615</span><span class="p">,</span> <span class="n">max_value</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_random_distribution</span><span class="p">[</span><span class="n">distribution_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_structure</span><span class="p">(</span><span class="n">structure_id</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RANDOM_DIST</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">distribution_id</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">structure_id</span><span class="p">})</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">DECLARE_RANDOM_DIST</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; distribution_id=</span><span class="si">{0:d}</span><span class="s2"> structure_id=</span><span class="si">{1:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">distribution_id</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.call_random_distribution"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.call_random_distribution">[docs]</a>    <span class="k">def</span> <span class="nf">call_random_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distribution_id</span><span class="p">,</span> <span class="n">register_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to get the next random number from a random\</span>
<span class="sd">            distribution, placing the result in a register to be used in a\</span>
<span class="sd">            future call</span>

<span class="sd">        :param int distribution_id:</span>
<span class="sd">            The ID of the random distribution to call between 0 and 63</span>
<span class="sd">        :param int register_id:</span>
<span class="sd">            The ID of the register to store the result in between 0 and 15</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise NotAllocatedException:</span>
<span class="sd">            If the random distribution ID was not previously declared</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            If the ``distribution_id`` or ``register_id`` specified was out</span>
<span class="sd">            of range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">GET_RANDOM_NUMBER</span><span class="p">,</span> <span class="s2">&quot;register_id&quot;</span><span class="p">,</span>
                <span class="n">register_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">GET_RANDOM_NUMBER</span><span class="p">,</span> <span class="s2">&quot;distribution_id&quot;</span><span class="p">,</span>
                <span class="n">distribution_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_RANDOM_DISTS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_distribution</span><span class="p">[</span><span class="n">distribution_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;random number distribution&quot;</span><span class="p">,</span> <span class="n">distribution_id</span><span class="p">,</span>
                <span class="n">Commands</span><span class="o">.</span><span class="n">GET_RANDOM_NUMBER</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">GET_RANDOM_NUMBER</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="mh">0x4</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">register_id</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">distribution_id</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">GET_RANDOM_NUMBER</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; distribution=</span><span class="si">{0:d}</span><span class="s2"> dest=reg[</span><span class="si">{1:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">distribution_id</span><span class="p">,</span> <span class="n">register_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.define_structure"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.define_structure">[docs]</a>    <span class="k">def</span> <span class="nf">define_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert commands to define a data structure</span>

<span class="sd">        :param int structure_id:</span>
<span class="sd">            the ID of the structure to create, between 0 and 15</span>
<span class="sd">        :param parameters: A list of between 1 and 255 tuples of</span>
<span class="sd">            `(label, data_type, value)` where:</span>

<span class="sd">            * `label` is the label of the element (for debugging)</span>
<span class="sd">            * `data_type` is the data type of the element</span>
<span class="sd">            * `value` is the value of the element, or None if no value is to</span>
<span class="sd">               be assigned</span>
<span class="sd">        :type parameters: list(tuple(str, DataType, float))</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise NoMoreException:</span>
<span class="sd">            If there are no more spaces for new structures</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If there are an incorrect number of parameters</span>
<span class="sd">            * If the size of one of the tuples is incorrect</span>
<span class="sd">            * If one of the values to be assigned has an integer ``data_type``</span>
<span class="sd">              but has a fractional part</span>
<span class="sd">            * If one of the values to be assigned would overflow its</span>
<span class="sd">              ``data_type``</span>
<span class="sd">        :raise UnknownTypeException:</span>
<span class="sd">            If one of the data types in the structure is unknown</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># start of struct</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">START_STRUCT</span><span class="p">,</span> <span class="s2">&quot;structure ID&quot;</span><span class="p">,</span>
                <span class="n">structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">START_STRUCT</span><span class="p">,</span> <span class="s2">&quot;structure elements&quot;</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MAX_STRUCT_ELEMENTS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">structure_id</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StructureInUseException</span><span class="p">(</span><span class="n">structure_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">structure_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">START_STRUCT</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">structure_id</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">START_STRUCT</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; ID=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">structure_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span>

        <span class="c1"># elements of the struct</span>
        <span class="k">for</span> <span class="n">elem_index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
            <span class="n">label</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DataType</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UnknownTypeException</span><span class="p">(</span>
                    <span class="n">data_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="o">.</span><span class="n">name</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; element_id=</span><span class="si">{0:d}</span><span class="s2">, element_type=</span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">elem_index</span><span class="p">,</span> <span class="n">data_type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">STRUCT_ELEM</span><span class="p">,</span> <span class="p">{</span>
                        <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN2</span><span class="p">,</span>
                        <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">data_type</span><span class="p">})</span>
                <span class="k">elif</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">STRUCT_ELEM</span><span class="p">,</span> <span class="p">{</span>
                        <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN3</span><span class="p">,</span>
                        <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">data_type</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidSizeException</span><span class="p">(</span>
                        <span class="n">data_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                        <span class="n">Commands</span><span class="o">.</span><span class="n">STRUCT_ELEM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                <span class="n">value_bytes</span> <span class="o">=</span> <span class="n">data_type</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;, value=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;, value=</span><span class="si">{0:f}</span><span class="s2">, label=</span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span>
                    <span class="n">cmd_word</span> <span class="o">+</span> <span class="n">value_bytes</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">STRUCT_ELEM</span><span class="p">,</span> <span class="p">{</span>
                    <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
                    <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">data_type</span><span class="p">})</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
                    <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;, label=</span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span>

        <span class="c1"># end of struct</span>
        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">END_STRUCT</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">END_STRUCT</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; ID=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">structure_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.get_structure_value"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.get_structure_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_structure_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">,</span> <span class="n">parameter_index</span><span class="p">,</span>
            <span class="n">parameter_index_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to get a value from a structure.\</span>
<span class="sd">            The value is copied in a register.</span>

<span class="sd">        :param int destination_id: The ID of the destination register</span>
<span class="sd">        :param int structure_id: The ID of the source structure</span>
<span class="sd">        :param int parameter_index: The ID of the parameter/element to copy</span>
<span class="sd">        :param bool parameter_index_is_register:</span>
<span class="sd">            True if ``parameter_index`` is a register ID containing the ID of</span>
<span class="sd">            the parameter/element to copy</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``structure_id`` is not in the allowed range</span>
<span class="sd">            * If ``parameter_index`` is larger than the number of parameters</span>
<span class="sd">              declared in the original structure</span>
<span class="sd">            * If ``destination_id`` is not the ID of a valid register</span>
<span class="sd">            * If ``parameter_index_is_register`` is True and</span>
<span class="sd">              ``parameter_index`` is not a valid register ID</span>
<span class="sd">        :raise NotAllocatedException:</span>
<span class="sd">            If the structure requested has not been declared</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">READ_PARAM</span><span class="p">,</span> <span class="s2">&quot;structure_id&quot;</span><span class="p">,</span>
                <span class="n">structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">READ_PARAM</span><span class="p">,</span> <span class="s2">&quot;destination_id&quot;</span><span class="p">,</span>
                <span class="n">destination_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">structure_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">READ_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">READ_PARAM</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; structure_id=</span><span class="si">{0:d}</span><span class="s2">, &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">structure_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parameter_index_is_register</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">READ_PARAM</span><span class="p">,</span> <span class="s2">&quot;parameter_index&quot;</span><span class="p">,</span>
                    <span class="n">parameter_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">READ_PARAM</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">DEST_AND_SRC1</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">destination_id</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">parameter_index</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">structure_id</span><span class="p">})</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;element_id_from_register=</span><span class="si">{0:d}</span><span class="s2">, &quot;</span>
                           <span class="s2">&quot;destination_register=</span><span class="si">{1:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                               <span class="n">parameter_index</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">READ_PARAM</span><span class="p">,</span> <span class="s2">&quot;parameter_index&quot;</span><span class="p">,</span>
                    <span class="n">parameter_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_ELEMENTS</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">structure_id</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">parameter_index</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                    <span class="s2">&quot;structure </span><span class="si">{0:d}</span><span class="s2"> parameter&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">structure_id</span><span class="p">),</span>
                    <span class="n">parameter_index</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">READ_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">READ_PARAM</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">DEST_ONLY</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">destination_id</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_2</span><span class="p">:</span> <span class="n">parameter_index</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">structure_id</span><span class="p">})</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;element_id=</span><span class="si">{0:d}</span><span class="s2">, destination_register=</span><span class="si">{1:d}</span><span class="s2">&quot;</span>
                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parameter_index</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.set_structure_value"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.set_structure_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_structure_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">,</span> <span class="n">parameter_index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                            <span class="n">data_type</span><span class="p">,</span> <span class="n">value_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to set a value in a structure</span>

<span class="sd">        :param int structure_id:</span>
<span class="sd">            * If called outside of a function, the ID of the structure,</span>
<span class="sd">              between 0 and 15</span>
<span class="sd">            * If called within a function, the ID of the structure</span>
<span class="sd">              argument, between 0 and 4</span>
<span class="sd">        :param int parameter_index: The index of the value to assign in the</span>
<span class="sd">            structure, between 0 and the number of parameters declared in the</span>
<span class="sd">            structure</span>
<span class="sd">        :param float value:</span>
<span class="sd">            * If ``value_is_register`` is False, the value to assign at the</span>
<span class="sd">              selected position as a float or int</span>
<span class="sd">            * If ``value_is_register`` is True, the ID of the register</span>
<span class="sd">              containing the value to assign to the position, between 0 and 15</span>
<span class="sd">        :param DataType data_type: type of the data to be stored in the</span>
<span class="sd">            structure. If parameter ``value_is_register`` is set to true,</span>
<span class="sd">            this variable is disregarded</span>
<span class="sd">        :param bool value_is_register:</span>
<span class="sd">            Identifies if value identifies a register</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``structure_id`` is not in the allowed range</span>
<span class="sd">            * If ``parameter_index`` is larger than the number of parameters</span>
<span class="sd">              declared in the original structure</span>
<span class="sd">            * If ``value_is_register`` is False, and the data type of the</span>
<span class="sd">              structure value is an integer, and ``value`` has a fractional</span>
<span class="sd">              part</span>
<span class="sd">            * If ``value_is_register`` is False, and ``value`` would overflow</span>
<span class="sd">              the position in the structure</span>
<span class="sd">            * If ``value_is_register`` is True, and ``value`` is not a valid</span>
<span class="sd">              register ID</span>
<span class="sd">        :raise NotAllocatedException:</span>
<span class="sd">            If the structure requested has not been declared</span>
<span class="sd">        :raise UnknownTypeException: If the data type is unknown</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="p">,</span> <span class="s2">&quot;structure_id&quot;</span><span class="p">,</span>
                <span class="n">structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="p">,</span> <span class="s2">&quot;parameter_index&quot;</span><span class="p">,</span>
                <span class="n">parameter_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_ELEMENTS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">structure_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">structure_id</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">parameter_index</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;structure </span><span class="si">{}</span><span class="s2"> parameter&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">structure_id</span><span class="p">),</span>
                <span class="n">parameter_index</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span>
                <span class="n">structure_id</span><span class="p">][</span><span class="n">parameter_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">data_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TypeMismatchException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; structure_id=</span><span class="si">{0:d}</span><span class="s2">, element_id=</span><span class="si">{1:d}</span><span class="s2">, &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">structure_id</span><span class="p">,</span> <span class="n">parameter_index</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">SRC1_ONLY</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">structure_id</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">parameter_index</span><span class="p">})</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;value=reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidSizeException</span><span class="p">(</span>
                    <span class="n">data_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_PARAM</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN2</span> <span class="k">if</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">else</span> <span class="n">LEN3</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">NO_REGS</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">structure_id</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">parameter_index</span><span class="p">})</span>
            <span class="n">value_encoded</span> <span class="o">=</span> <span class="n">data_type</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;value=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">value_encoded</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.write_structure"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.write_structure">[docs]</a>    <span class="k">def</span> <span class="nf">write_structure</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to write a structure to the current write pointer,\</span>
<span class="sd">            causing the current write pointer to move on by the number of\</span>
<span class="sd">            bytes needed to represent the structure</span>

<span class="sd">        :param int structure_id:</span>
<span class="sd">            * If called within a function, the ID of the structure to write,</span>
<span class="sd">              between 0 and 15</span>
<span class="sd">            * If called outside of a function, the ID of the structure</span>
<span class="sd">              argument, between 0 and 5</span>
<span class="sd">        :param int repeats:</span>
<span class="sd">            * If ``repeats_is_register`` is True, the ID of the register</span>
<span class="sd">              containing the number of repeats, between 0 and 15</span>
<span class="sd">            * If ``repeats_is_register`` is False, the number of repeats to</span>
<span class="sd">              write, between 0 and 255</span>
<span class="sd">        :param bool repeats_is_register:</span>
<span class="sd">            Whether ``repeats`` identifies a register</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``structure_id`` is not a valid structure ID</span>
<span class="sd">            * If ``repeats_is_register`` is False and ``repeats`` is not in</span>
<span class="sd">              range</span>
<span class="sd">            * If ``repeats_is_register`` is True and ``repeats`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">        :raise NoRegionSelectedException: If no region has been selected</span>
<span class="sd">        :raise RegionExhaustedException:</span>
<span class="sd">            If the selected region has no more space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_STRUCT</span><span class="p">,</span> <span class="s2">&quot;structure_id&quot;</span><span class="p">,</span>
                <span class="n">structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">structure_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_STRUCT</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_STRUCT</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; structure_id=</span><span class="si">{0:d}</span><span class="s2">, &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">structure_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">repeats_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_STRUCT</span><span class="p">,</span> <span class="s2">&quot;repeats&quot;</span><span class="p">,</span>
                    <span class="n">repeats</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_STRUCT</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">SRC1_ONLY</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">repeats</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">structure_id</span><span class="p">})</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;repeats=reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_STRUCT</span><span class="p">,</span> <span class="s2">&quot;repeats&quot;</span><span class="p">,</span>
                    <span class="n">repeats</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_STRUCT</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">repeats</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">structure_id</span><span class="p">})</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;repeats=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.start_function"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.start_function">[docs]</a>    <span class="k">def</span> <span class="nf">start_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_id</span><span class="p">,</span> <span class="n">argument_by_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to start a function definition, with up to 5\</span>
<span class="sd">            arguments, which are the IDs of structures to be used within the\</span>
<span class="sd">            function, each of which can be passed by reference or by value.\</span>
<span class="sd">            In the commands following this command up to the\</span>
<span class="sd">            :meth:`end_function` command, structures can only be referenced\</span>
<span class="sd">            using the numbers 1 to 5 which address the arguments, rather than\</span>
<span class="sd">            the original structure IDs</span>

<span class="sd">        :param int function_id: The ID of the function currently defined.</span>
<span class="sd">        :param list(bool) argument_by_value: A list of up to 5 booleans</span>
<span class="sd">            indicating if the structure to be passed as an argument is to be</span>
<span class="sd">            passed by reference (i.e., changes made within the function are</span>
<span class="sd">            persisted) or by value (i.e., changes made within the function</span>
<span class="sd">            are lost when the function exits. The number of arguments is</span>
<span class="sd">            determined by the length of this list.</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            If there are too many items in the list of arguments</span>
<span class="sd">        :raise InvalidCommandException:</span>
<span class="sd">            If there is already a function being defined at this point</span>
<span class="sd">        :raise FunctionInUseException: If the function is already defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ongoing_function_definition</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidCommandException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">START_CONSTRUCTOR</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">START_CONSTRUCTOR</span><span class="p">,</span> <span class="s2">&quot;number of arguments&quot;</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">argument_by_value</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">START_CONSTRUCTOR</span><span class="p">,</span> <span class="s2">&quot;function_id&quot;</span><span class="p">,</span>
                <span class="n">function_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_CONSTRUCTORS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function_slots</span><span class="p">[</span><span class="n">function_id</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FunctionInUseException</span><span class="p">(</span><span class="n">function_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_function_slots</span><span class="p">[</span><span class="n">function_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">argument_by_value</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">START_CONSTRUCTOR</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; ID=</span><span class="si">{0:d}</span><span class="s2"> number_of_args=</span><span class="si">{1:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">function_id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">argument_by_value</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ongoing_function_definition</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">read_only_flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">abv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">argument_by_value</span><span class="p">):</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; arg[</span><span class="si">{0:d}</span><span class="s2">]=&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">abv</span><span class="p">:</span>
                <span class="n">read_only_flags</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span>
                <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;read-only&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;read-write&quot;</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">START_CONSTRUCTOR</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">FUNCTION</span><span class="p">:</span> <span class="n">function_id</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">argument_by_value</span><span class="p">),</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">read_only_flags</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.end_function"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.end_function">[docs]</a>    <span class="k">def</span> <span class="nf">end_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to mark the end of a function definition</span>

<span class="sd">        :raise InvalidCommandException:</span>
<span class="sd">            If there is no function being defined at this point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ongoing_function_definition</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidCommandException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">END_CONSTRUCTOR</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ongoing_function_definition</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">END_CONSTRUCTOR</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">END_CONSTRUCTOR</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">,</span> <span class="n">outdent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.call_function"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.call_function">[docs]</a>    <span class="k">def</span> <span class="nf">call_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_id</span><span class="p">,</span> <span class="n">structure_ids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to call a function</span>

<span class="sd">        :param int function_id:</span>
<span class="sd">            The ID of a previously defined function, between 0 and 31</span>
<span class="sd">        :param structure_ids: A list of structure IDs that will be passed into</span>
<span class="sd">            the function, each between 0 and 15</span>
<span class="sd">        :type structure_ids: list(int)</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If the function ID is not valid</span>
<span class="sd">            * If any of the structure IDs are not valid</span>
<span class="sd">        :raise NotAllocatedException:</span>
<span class="sd">            * If a function has not been defined with the given ID</span>
<span class="sd">            * If no structure has been defined with one of the IDs in</span>
<span class="sd">              ``structure_ids``</span>
<span class="sd">        :raise WrongParameterNumberException:</span>
<span class="sd">            If a function is called with a wrong number of parameters</span>
<span class="sd">        :raise DuplicateParameterException:</span>
<span class="sd">            If a function is called with duplicate parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">CONSTRUCT</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
                <span class="n">function_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_CONSTRUCTORS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function_slots</span><span class="p">[</span><span class="n">function_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;function&quot;</span><span class="p">,</span> <span class="n">function_id</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">CONSTRUCT</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">structure_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_function_slots</span><span class="p">[</span><span class="n">function_id</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">WrongParameterNumberException</span><span class="p">(</span>
                <span class="n">function_id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_function_slots</span><span class="p">[</span><span class="n">function_id</span><span class="p">]),</span>
                <span class="n">structure_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">structure_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">structure_ids</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">DuplicateParameterException</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">CONSTRUCT</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">function_id</span><span class="p">),</span>
                <span class="n">structure_ids</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">CONSTRUCT</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; function_id=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">function_id</span><span class="p">)</span>

        <span class="n">param_word_encoded</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
        <span class="n">cmd_word_length</span> <span class="o">=</span> <span class="n">LEN1</span>
        <span class="k">if</span> <span class="n">structure_ids</span><span class="p">:</span>
            <span class="n">param_word</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">struct_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">structure_ids</span><span class="p">):</span>
                <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">CONSTRUCT</span><span class="p">,</span>
                        <span class="s2">&quot;structure argument </span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                        <span class="n">structure_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">struct_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                        <span class="s2">&quot;structure argument </span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                        <span class="n">struct_id</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">CONSTRUCT</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                <span class="n">param_word</span> <span class="o">|=</span> <span class="n">struct_id</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; arg[</span><span class="si">{0:d}</span><span class="s2">]=struct[</span><span class="si">{1:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">struct_id</span><span class="p">)</span>

            <span class="n">cmd_word_length</span> <span class="o">=</span> <span class="n">LEN2</span>
            <span class="n">param_word_encoded</span> <span class="o">+=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">param_word</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">CONSTRUCT</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">cmd_word_length</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">function_id</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">param_word_encoded</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.read_value"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.read_value">[docs]</a>    <span class="k">def</span> <span class="nf">read_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest_id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to read a value from the current write pointer,\</span>
<span class="sd">            causing the write pointer to move by the number of bytes read.\</span>
<span class="sd">            The data is stored in a register passed as argument.</span>

<span class="sd">        :param int dest_id: The ID of the destination register.</span>
<span class="sd">        :param DataType data_type: The type of the data to be read.</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            If ``dest_id`` is out of range for a register ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DataType</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnknownTypeException</span><span class="p">(</span>
                <span class="n">data_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">READ</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">READ</span><span class="p">,</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="n">dest_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">READ</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">DEST_ONLY</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">dest_id</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">READ</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{0:d}</span><span class="s2"> bytes in register </span><span class="si">{1:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">data_type</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dest_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.create_cmd"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.create_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">create_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates command to write a value to the current write pointer,\</span>
<span class="sd">            causing the write pointer to move on by the number of bytes\</span>
<span class="sd">            required to represent the data type. The data is passed as a\</span>
<span class="sd">            parameter to this function.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This does not actually insert the ``WRITE`` command in the spec;</span>
<span class="sd">            that is done by :py:meth:`write_cmd`.</span>

<span class="sd">        :param data: the data to write.</span>
<span class="sd">        :type data: int or float</span>
<span class="sd">        :param DataType data_type: the type to convert ``data`` to</span>
<span class="sd">        :return: ``cmd_word_list`` (binary data to be added to the binary data</span>
<span class="sd">            specification file), and ``cmd_string`` (string describing the</span>
<span class="sd">            command to be added to the report for the data specification file)</span>
<span class="sd">        :rtype: tuple(bytearray, str)</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``data_type`` is an integer type, and ``data`` has a</span>
<span class="sd">              fractional part</span>
<span class="sd">            * If ``data`` would overflow the data type</span>
<span class="sd">        :raise UnknownTypeException: If the data type is not known</span>
<span class="sd">        :raise InvalidSizeException: If the data size is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>

        <span class="n">data_size</span> <span class="o">=</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="n">LEN2</span>
            <span class="n">data_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="n">LEN2</span>
            <span class="n">data_len</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="n">LEN2</span>
            <span class="n">data_len</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="n">LEN3</span>
            <span class="n">data_len</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidSizeException</span><span class="p">(</span>
                <span class="n">data_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data_size</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_report_writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; data=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">repeat_reg_usage</span> <span class="o">=</span> <span class="n">NO_REGS</span>
        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">cmd_data_len</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">repeat_reg_usage</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">data_len</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="c1"># 1 is based on parameters = 0, repeats = 1 and parameters |= repeats</span>

        <span class="n">cmd_word_list</span> <span class="o">=</span> <span class="n">cmd_word</span> <span class="o">+</span> <span class="n">data_type</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_report_writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;, dataType=</span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">cmd_word_list</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.write_value"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.write_value">[docs]</a>    <span class="k">def</span> <span class="nf">write_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to write a value (once) to the current\</span>
<span class="sd">            write pointer, causing the write pointer to move on by the number\</span>
<span class="sd">            of bytes required to represent the data type. The data is passed\</span>
<span class="sd">            as a parameter to this function</span>

<span class="sd">        .. note::</span>
<span class="sd">            This method used to have two extra parameters ``repeats`` and\</span>
<span class="sd">            ``repeats_is_register``. They have been removed here. If you need\</span>
<span class="sd">            them, use :meth:`write_repeated_value`</span>

<span class="sd">        :param data: the data to write as a float.</span>
<span class="sd">        :type data: int or float</span>
<span class="sd">        :param DataType data_type: the type to convert ``data`` to</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``data_type`` is an integer type, and ``data`` has a</span>
<span class="sd">              fractional part</span>
<span class="sd">            * If ``data`` would overflow the data type</span>
<span class="sd">        :raise UnknownTypeException: If the data type is not known</span>
<span class="sd">        :raise InvalidSizeException: If the data size is invalid</span>
<span class="sd">        :raise NoRegionSelectedException: If no region has been selected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoRegionSelectedException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">cmd_word_list</span><span class="p">,</span> <span class="n">cmd_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word_list</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.write_cmd"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.write_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">write_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd_word_list</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Applies write commands created previously created (and cached).</span>

<span class="sd">        .. note::</span>
<span class="sd">            See :meth:`create_cmd` for how to create the arguments to\</span>
<span class="sd">            this method.</span>

<span class="sd">        :param bytearray cmd_word_list: list of binary words to be added to</span>
<span class="sd">            the binary data specification file</span>
<span class="sd">        :param str cmd_string: string describing the command to be added to</span>
<span class="sd">            the report for the data specification file</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise NoRegionSelectedException: If no region has been selected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoRegionSelectedException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word_list</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.write_repeated_value"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.write_repeated_value">[docs]</a>    <span class="k">def</span> <span class="nf">write_repeated_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to write a value one or more times to the current\</span>
<span class="sd">            write pointer, causing the write pointer to move on by the number\</span>
<span class="sd">            of bytes required to represent the data type. The data is passed\</span>
<span class="sd">            as a parameter to this function</span>

<span class="sd">        :param data: the data to write as a float.</span>
<span class="sd">        :type data: float or int</span>
<span class="sd">        :param int repeats:</span>
<span class="sd">            * If ``repeats_is_register`` is False, this parameter identifies</span>
<span class="sd">              the number of times to repeat the data, between 1 and 255</span>
<span class="sd">              (default 1)</span>
<span class="sd">            * If ``repeats_is_register`` is True, this parameter identifies</span>
<span class="sd">              the register that contains the number of repeats.</span>
<span class="sd">        :param bool repeats_is_register:</span>
<span class="sd">            Indicates if the parameter ``repeats`` identifies the register</span>
<span class="sd">            containing the number of repeats of the value to write</span>
<span class="sd">        :param DataType data_type: the type to convert data to</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``repeats_is_register`` is False, and ``repeats`` is out of</span>
<span class="sd">              range</span>
<span class="sd">            * If ``repeats_is_register`` is True, and ``repeats`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">            * If ``data_type`` is an integer type, and ``data`` has a</span>
<span class="sd">              fractional part</span>
<span class="sd">            * If ``data`` would overflow the data type</span>
<span class="sd">        :raise UnknownTypeException: If the data type is not known</span>
<span class="sd">        :raise InvalidSizeException: If the data size is invalid</span>
<span class="sd">        :raise NoRegionSelectedException: If no region has been selected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoRegionSelectedException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>

        <span class="n">data_size</span> <span class="o">=</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="n">LEN2</span>
            <span class="n">data_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="n">LEN2</span>
            <span class="n">data_len</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="n">LEN2</span>
            <span class="n">data_len</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="n">LEN3</span>
            <span class="n">data_len</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidSizeException</span><span class="p">(</span>
                <span class="n">data_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data_size</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">repeats_is_register</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> <span class="s2">&quot;repeats&quot;</span><span class="p">,</span> <span class="n">repeats</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> <span class="s2">&quot;repeats&quot;</span><span class="p">,</span> <span class="n">repeats</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; data=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">repeats_is_register</span><span class="p">:</span>
            <span class="n">repeat_reg_usage</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">parameters</span> <span class="o">|=</span> <span class="p">(</span><span class="n">repeats</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;, repeats=reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">repeat_reg_usage</span> <span class="o">=</span> <span class="n">NO_REGS</span>
            <span class="n">parameters</span> <span class="o">|=</span> <span class="n">repeats</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;, repeats=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">cmd_data_len</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">repeat_reg_usage</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">data_len</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">parameters</span><span class="p">})</span>
        <span class="n">data_word</span> <span class="o">=</span> <span class="n">data_type</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;, dataType=</span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">data_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.write_value_from_register"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.write_value_from_register">[docs]</a>    <span class="k">def</span> <span class="nf">write_value_from_register</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">data_register</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to write a value one or more times at the write\</span>
<span class="sd">            pointer of the current memory region, causing it to move.\</span>
<span class="sd">            The data is contained in a register whose ID is passed to the\</span>
<span class="sd">            function</span>

<span class="sd">        :param int data_register:</span>
<span class="sd">            Identifies the register in which the data is stored.</span>
<span class="sd">        :param int repeats:</span>
<span class="sd">            * If ``repeats_is_register`` is None, this parameter identifies</span>
<span class="sd">              the number of times to repeat the data, between 1 and 255</span>
<span class="sd">              (default 1)</span>
<span class="sd">            * If ``repeats_is_register`` is not None (i.e. has an integer</span>
<span class="sd">              value), the content of this parameter is disregarded</span>
<span class="sd">        :param bool repeats_is_register: Identifies if ``repeats`` is the</span>
<span class="sd">            register containing the number of repeats of the value to write</span>
<span class="sd">        :param DataType data_type: the type of the data held in the register</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``repeats_is_register`` is False, and ``repeats`` is out of</span>
<span class="sd">              range</span>
<span class="sd">            * If ``repeats_is_register`` is True, and ``repeats`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">            * If ``data_register`` is not a valid register ID</span>
<span class="sd">        :raise UnknownTypeException: If the data type is not known</span>
<span class="sd">        :raise NoRegionSelectedException: If no region has been selected</span>
<span class="sd">        :raise RegionExhaustedException:</span>
<span class="sd">            If the selected region has no more space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DataType</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnknownTypeException</span><span class="p">(</span>
                <span class="n">data_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoRegionSelectedException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">data_size</span> <span class="o">=</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">data_size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">cmd_data_len</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidSizeException</span><span class="p">(</span>
                <span class="n">data_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data_size</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">repeats_is_register</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> <span class="s2">&quot;repeats&quot;</span><span class="p">,</span> <span class="n">repeats</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> <span class="s2">&quot;repeats&quot;</span><span class="p">,</span> <span class="n">repeats</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> <span class="s2">&quot;data_register&quot;</span><span class="p">,</span>
                <span class="n">data_register</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; data=reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_register</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">repeats_is_register</span><span class="p">:</span>
            <span class="n">reg_usage</span> <span class="o">=</span> <span class="n">SRC1_AND_SRC2</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">repeats</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;, repeats=reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reg_usage</span> <span class="o">=</span> <span class="n">SRC1_ONLY</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">repeats</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;, repeats=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">reg_usage</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">cmd_data_len</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">data_register</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">parameters</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot;, dataType=</span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.write_array"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.write_array">[docs]</a>    <span class="k">def</span> <span class="nf">write_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array_values</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to write an array, causing the write pointer\</span>
<span class="sd">            to move on by (data type size * the array size), in bytes.</span>

<span class="sd">        :param array_values: An array of words to be written</span>
<span class="sd">        :type array_values: list(int) or list(float) or ~numpy.ndarray</span>
<span class="sd">        :param DataType data_type: Type of data contained in the array</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise NoRegionSelectedException: If no region has been selected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_type</span><span class="o">.</span><span class="n">numpy_typename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TypeMismatchException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_ARRAY</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoRegionSelectedException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_ARRAY</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data_type</span><span class="o">.</span><span class="n">numpy_typename</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnknownTypeLengthException</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_ARRAY</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_ARRAY</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN2</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">WRITE_ARRAY</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{0:d}</span><span class="s2"> elements</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">array_values</span><span class="p">))</span>
        <span class="n">arg_word</span> <span class="o">=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">size</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">arg_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spec_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.switch_write_focus"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.switch_write_focus">[docs]</a>    <span class="k">def</span> <span class="nf">switch_write_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to switch the region being written to</span>

<span class="sd">        :param int region: The ID of the region to switch to, between 0 and 15</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            If the region identifier is not valid</span>
<span class="sd">        :raise NotAllocatedException: If the region has not been allocated</span>
<span class="sd">        :raise RegionUnfilledException:</span>
<span class="sd">            If the selected region should not be filled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">SWITCH_FOCUS</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_MEM_REGIONS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">SWITCH_FOCUS</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">[</span><span class="n">region</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RegionUnfilledException</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">SWITCH_FOCUS</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span> <span class="o">=</span> <span class="n">region</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">SWITCH_FOCUS</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; memRegion = </span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
        <span class="c1"># Write command to switch focus:</span>
        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">SWITCH_FOCUS</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="mh">0x0</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">region</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.start_loop"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.start_loop">[docs]</a>    <span class="k">def</span> <span class="nf">start_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter_register_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">increment</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">start_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">end_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">increment_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to start a loop</span>

<span class="sd">        :param int counter_register_id: The ID of the register to use as the</span>
<span class="sd">            loop counter, between 0 and 15</span>
<span class="sd">        :param int start:</span>
<span class="sd">            * If ``start_is_register`` is False, the number at which to start</span>
<span class="sd">              the loop counter, &gt;= 0</span>
<span class="sd">            * If ``start_is_register`` is True, the ID of the register</span>
<span class="sd">              containing the number at which to start the loop counter,</span>
<span class="sd">              between 0 and 15</span>
<span class="sd">        :param int end:</span>
<span class="sd">            * If ``end_is_register`` is False, the number which the loop</span>
<span class="sd">              counter must reach to stop the loop i.e. the loop will run while</span>
<span class="sd">              the contents of ``counter_register`` &lt; ``end``, &gt;= 0</span>
<span class="sd">            * If ``end_is_register`` is True, the ID of the register</span>
<span class="sd">              containing the number at which to stop the loop, between 0 and 15</span>
<span class="sd">        :param int increment:</span>
<span class="sd">            * If ``increment_is_register`` is False, the amount by which to</span>
<span class="sd">              increment the loop counter on each run of the loop, &gt;= 0</span>
<span class="sd">            * If ``increment_is_register`` is True, the ID of the register</span>
<span class="sd">              containing the amount by which to increment the loop counter on</span>
<span class="sd">              each run of the loop, between 0 and 15</span>
<span class="sd">        :param bool start_is_register: Indicates if ``start`` is a register ID</span>
<span class="sd">        :param bool end_is_register: Indicates if ``end`` is a register ID</span>
<span class="sd">        :param bool increment_is_register:</span>
<span class="sd">            Indicates if ``increment`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``counter_register_id`` is not a valid register ID</span>
<span class="sd">            * If ``start_is_register`` is True and ``start`` is not a valid</span>
<span class="sd">              register ID</span>
<span class="sd">            * If ``end_is_register`` is True and ``end`` is not a valid</span>
<span class="sd">              register ID</span>
<span class="sd">            * If ``increment_is_register`` is True, and ``increment`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">            * If ``start_is_register is False and ``start`` is not in the</span>
<span class="sd">              allowed range</span>
<span class="sd">            * If ``end_is_register is False and ``end`` is not in the allowed</span>
<span class="sd">              range</span>
<span class="sd">            * If ``increment_is_register`` is False and ``increment`` is not</span>
<span class="sd">              in the allowed range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOOP</span><span class="p">,</span> <span class="s2">&quot;counter_register_id&quot;</span><span class="p">,</span>
                <span class="n">counter_register_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>

        <span class="n">bit_field</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">LEN1</span>
        <span class="n">encoded_values</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">LOOP</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; counter_register_id=reg[</span><span class="si">{0:d}</span><span class="s2">],&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">counter_register_id</span><span class="p">)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">r3</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">start_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOOP</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="mh">0x4</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="n">start</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; start=reg[</span><span class="si">{0:d}</span><span class="s2">],&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOOP</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">encoded_values</span> <span class="o">+=</span> <span class="n">_ONE_SIGNED_INT</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; start=</span><span class="si">{0:d}</span><span class="s2">,&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">end_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOOP</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="mh">0x2</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">end</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; end=reg[</span><span class="si">{0:d}</span><span class="s2">],&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOOP</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">encoded_values</span> <span class="o">+=</span> <span class="n">_ONE_SIGNED_INT</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; end=</span><span class="si">{0:d}</span><span class="s2">,&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">increment_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOOP</span><span class="p">,</span> <span class="s2">&quot;increment&quot;</span><span class="p">,</span> <span class="n">increment</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="mh">0x1</span>
            <span class="n">r3</span> <span class="o">=</span> <span class="n">increment</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; increment=reg[</span><span class="si">{0:d}</span><span class="s2">],&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">increment</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOOP</span><span class="p">,</span> <span class="s2">&quot;increment&quot;</span><span class="p">,</span> <span class="n">increment</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">encoded_values</span> <span class="o">+=</span> <span class="n">_ONE_SIGNED_INT</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">increment</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; increment=</span><span class="si">{0:d}</span><span class="s2">,&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">increment</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ongoing_loop</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOOP</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">length</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">bit_field</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">r1</span><span class="p">,</span>   <span class="c1"># non-standard usage</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>      <span class="c1"># non-standard usage</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_2</span><span class="p">:</span> <span class="n">r3</span><span class="p">,</span>      <span class="c1"># non-standard usage</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">counter_register_id</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">encoded_values</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.break_loop"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.break_loop">[docs]</a>    <span class="k">def</span> <span class="nf">break_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to break out of a loop before it has completed</span>

<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise InvalidCommandException:</span>
<span class="sd">            If there is no loop in operation at this point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ongoing_loop</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidCommandException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">BREAK_LOOP</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">BREAK_LOOP</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">BREAK_LOOP</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.end_loop"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.end_loop">[docs]</a>    <span class="k">def</span> <span class="nf">end_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to indicate that this is the end of the loop.\</span>
<span class="sd">            Commands between the start of the loop and this command will be\</span>
<span class="sd">            repeated.</span>

<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise InvalidCommandException:</span>
<span class="sd">            If there is no loop in operation at this point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ongoing_loop</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidCommandException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">END_LOOP</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">END_LOOP</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">END_LOOP</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ongoing_loop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.start_conditional"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.start_conditional">[docs]</a>    <span class="k">def</span> <span class="nf">start_conditional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                          <span class="n">value_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to start a conditional if...then...else construct.\</span>
<span class="sd">            If the condition evaluates to true, the statement is executed up\</span>
<span class="sd">            to the next else statement, or the end of the conditional,\</span>
<span class="sd">            whichever comes first.</span>

<span class="sd">        :param int register_id: The ID of a register to compare the value of</span>
<span class="sd">        :param Condition condition:</span>
<span class="sd">            The condition which must be true to execute the following commands</span>
<span class="sd">        :param int value:</span>
<span class="sd">            * If ``value_is_register`` is False, the value to compare to the</span>
<span class="sd">              value in the register</span>
<span class="sd">            * If ``value_is_register`` is True, the ID of the register</span>
<span class="sd">              containing the value to compare, between 0 and 15</span>
<span class="sd">        :param bool value_is_register: Indicates if ``value`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``register_id`` is not a valid register ID</span>
<span class="sd">            * if ``value_is_register`` is True and ``value`` is not a valid</span>
<span class="sd">              register ID</span>
<span class="sd">        :raise UnknownConditionException:</span>
<span class="sd">            If ``condition`` is not a valid condition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">IF</span><span class="p">,</span> <span class="s2">&quot;register_id&quot;</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">condition</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Condition</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnknownConditionException</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">IF</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">data_encoded</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">IF</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">value_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">IF</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">IF</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="mh">0x3</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">register_id</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_2</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">condition</span><span class="p">})</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">] </span><span class="si">{1:s}</span><span class="s2"> reg[</span><span class="si">{2:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">register_id</span><span class="p">,</span> <span class="n">condition</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">IF</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>
            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">IF</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN2</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="mh">0x2</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">register_id</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">condition</span><span class="p">})</span>
            <span class="n">data_encoded</span> <span class="o">+=</span> <span class="n">_ONE_SIGNED_INT</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">] </span><span class="si">{1:s}</span><span class="s2"> </span><span class="si">{2:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">register_id</span><span class="p">,</span> <span class="n">condition</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_conditionals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cmd_word_list</span> <span class="o">=</span> <span class="n">cmd_word</span> <span class="o">+</span> <span class="n">data_encoded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word_list</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.else_conditional"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.else_conditional">[docs]</a>    <span class="k">def</span> <span class="nf">else_conditional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command for the else of an if...then...else construct.\</span>
<span class="sd">            If the condition of the conditional evaluates to false, the\</span>
<span class="sd">            statements up between the conditional and the insertion of this\</span>
<span class="sd">            &quot;else&quot; are skipped, and the statements from this point until the\</span>
<span class="sd">            end of the conditional are executed.</span>

<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise InvalidCommandException:</span>
<span class="sd">            If there is no conditional in operation at this point</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conditionals</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_conditionals</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conditionals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidCommandException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ELSE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_conditionals</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conditionals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ELSE</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">ELSE</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span>
            <span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outdent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.end_conditional"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.end_conditional">[docs]</a>    <span class="k">def</span> <span class="nf">end_conditional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to mark the end of an if...then...else construct</span>

<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise InvalidCommandException:</span>
<span class="sd">            If there is no conditional in operation at this point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conditionals</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidCommandException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">END_IF</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_conditionals</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">END_IF</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">END_IF</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">,</span> <span class="n">outdent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.set_register_value"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.set_register_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_register_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to set the value of a register</span>

<span class="sd">        :param int register_id:</span>
<span class="sd">            The ID of the register to assign, between 0 and 15</span>
<span class="sd">        :param data:</span>
<span class="sd">            * If ``data_is_register`` is True, the register ID containing</span>
<span class="sd">              the data to set, between 0 and 15</span>
<span class="sd">            * If ``data_is_register`` is False, the data is a value of the</span>
<span class="sd">              type given by ``data_type``</span>
<span class="sd">        :type data: int or float</span>
<span class="sd">        :param bool data_is_register: Indicates if ``data`` is a register ID</span>
<span class="sd">        :param DataType data_type: The type of the data to be assigned</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``register_id`` is not a valid register ID</span>
<span class="sd">            * If ``data_is_register`` is True, and ``data`` is not a valid</span>
<span class="sd">              register ID</span>
<span class="sd">            * If ``data_is_register`` is False, ``data_type`` is an integer</span>
<span class="sd">              type and ``data`` has a fractional part</span>
<span class="sd">            * If ``data_is_register`` if False, and ``data`` would overflow</span>
<span class="sd">              the data type</span>
<span class="sd">        :raise UnknownTypeException: If the data type is not known</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">MV</span><span class="p">,</span> <span class="s2">&quot;register_id&quot;</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_is_register</span><span class="p">:</span>
            <span class="c1"># Build command to move between registers:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">MV</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="n">register_id</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DuplicateParameterException</span><span class="p">(</span>
                    <span class="n">Commands</span><span class="o">.</span><span class="n">MV</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="n">register_id</span><span class="p">,</span> <span class="n">data</span><span class="p">])</span>

            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">MV</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">DEST_AND_SRC1</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">register_id</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>
            <span class="n">encoded_data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
            <span class="n">cmd_string</span> <span class="o">=</span> <span class="s2">&quot;reg[</span><span class="si">{0:d}</span><span class="s2">] = reg[</span><span class="si">{1:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register_id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Build command to assign from an immediate:</span>
            <span class="c1"># command has a second word (the immediate)</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">MV</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>

            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">MV</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN3</span> <span class="k">if</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="n">LEN2</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">DEST_ONLY</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">register_id</span><span class="p">})</span>
            <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">data_type</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">=</span> <span class="s2">&quot;reg[</span><span class="si">{0:d}</span><span class="s2">] = </span><span class="si">{1:d}</span><span class="s2"> (0x</span><span class="si">{1:X}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">register_id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">encoded_data</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.save_write_pointer"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.save_write_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">save_write_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to save the write pointer to a register</span>

<span class="sd">        :param int register_id:</span>
<span class="sd">            The ID of the register to assign, between 0 and 15</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            If the ``register_id`` is not a valid register ID</span>
<span class="sd">        :raise NoRegionSelectedException: If no region has been selected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">GET_WR_PTR</span><span class="p">,</span> <span class="s2">&quot;register_id&quot;</span><span class="p">,</span>
                <span class="n">register_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoRegionSelectedException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">GET_WR_PTR</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">GET_WR_PTR</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="mh">0x4</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">register_id</span><span class="p">})</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">GET_WR_PTR</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.set_write_pointer"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.set_write_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">set_write_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">address_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">relative_to_current</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to set the position of the write pointer within the\</span>
<span class="sd">            current region</span>

<span class="sd">        :param int address:</span>
<span class="sd">            * If ``address_is_register`` is True, the ID of the register</span>
<span class="sd">              containing the address to move to</span>
<span class="sd">            * If ``address_is_register`` is False, the address to move the</span>
<span class="sd">              write pointer to</span>
<span class="sd">        :param bool address_is_register:</span>
<span class="sd">            Indicates if ``address`` is a register ID</span>
<span class="sd">        :param bool relative_to_current:</span>
<span class="sd">            Indicates if ``address`` (or the value read from that register</span>
<span class="sd">            when ``address_is_register`` is True) is to be added to the</span>
<span class="sd">            current address, or used as an absolute address from the start</span>
<span class="sd">            of the current region</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            If the ``address_is_register`` is True and ``address`` is not a</span>
<span class="sd">            valid register ID</span>
<span class="sd">        :raise NoRegionSelectedException: If no region has been selected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoRegionSelectedException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">SET_WR_PTR</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">relative</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">relative_to_current</span><span class="p">)</span>
        <span class="n">relative_string</span> <span class="o">=</span> <span class="s2">&quot;RELATIVE&quot;</span> <span class="k">if</span> <span class="n">relative</span> <span class="k">else</span> <span class="s2">&quot;ABSOLUTE&quot;</span>

        <span class="n">data_encoded</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">SET_WR_PTR</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">address_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">SET_WR_PTR</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">SET_WR_PTR</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">SRC1_ONLY</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">address</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">relative</span><span class="p">})</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">] </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">relative_string</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">relative_to_current</span><span class="p">:</span>
                <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">SET_WR_PTR</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">,</span>
                            <span class="n">address</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">)</span>
                <span class="n">data_encoded</span> <span class="o">+=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">SET_WR_PTR</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">,</span>
                            <span class="n">address</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>
                <span class="n">data_encoded</span> <span class="o">+=</span> <span class="n">_ONE_SIGNED_INT</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>

            <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">SET_WR_PTR</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN2</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">NO_REGS</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">relative</span><span class="p">})</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{0:d}</span><span class="s2"> </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">relative_string</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">data_encoded</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.align_write_pointer"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.align_write_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">align_write_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_block_size</span><span class="p">,</span>
                            <span class="n">log_block_size_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">return_register_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to align the write pointer against a power-of-2\</span>
<span class="sd">            block size in bytes.  Zeros are inserted in the intervening space</span>

<span class="sd">        :param int log_block_size:</span>
<span class="sd">            * If ``log_block_size_is_register`` is False, log to base 2 of</span>
<span class="sd">              the block size (e.g. The write pointer will be moved so that</span>
<span class="sd">              it is a multiple of 2\\ :sup:`log_block_size`), between 0 and 32</span>
<span class="sd">            * If ``log_block_size_is_register`` is True, the ID of the</span>
<span class="sd">              register containing log to the base 2 of the block size,</span>
<span class="sd">              between 0 and 15</span>
<span class="sd">        :param bool log_block_size_is_register:</span>
<span class="sd">            Indicates if ``log_block_size`` is a register ID</span>
<span class="sd">        :param return_register_id: The ID of a register where the write</span>
<span class="sd">            pointer will be written to once it has been updated, between</span>
<span class="sd">            0 and 15, or None if no such writing is to be done</span>
<span class="sd">        :type return_register_id: int or None</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``log_block_size_is_register`` is False, and</span>
<span class="sd">              ``log_block_size`` is not within the allowed range</span>
<span class="sd">            * If ``log_block_size_is_register`` is True and</span>
<span class="sd">              ``log_block_size`` is not a valid register ID</span>
<span class="sd">        :raise RegionOutOfBoundsException:</span>
<span class="sd">            If the move of the pointer would put it outside of the current</span>
<span class="sd">            region</span>
<span class="sd">        :raise NoRegionSelectedException: If no region has been selected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoRegionSelectedException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ALIGN_WR_PTR</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">bit_field</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">imm_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">return_register_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">block_size_reg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">ALIGN_WR_PTR</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">return_register_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ALIGN_WR_PTR</span><span class="p">,</span> <span class="s2">&quot;return_register_id&quot;</span><span class="p">,</span>
                    <span class="n">return_register_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="mh">0x4</span>
            <span class="n">return_register_value</span> <span class="o">=</span> <span class="n">return_register_id</span>
            <span class="n">cmd_string</span> <span class="o">=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">] =&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">return_register_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">log_block_size_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ALIGN_WR_PTR</span><span class="p">,</span> <span class="s2">&quot;log_block_size&quot;</span><span class="p">,</span>
                    <span class="n">log_block_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="mh">0x2</span>
            <span class="n">block_size_reg</span> <span class="o">=</span> <span class="n">log_block_size</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; align(reg[</span><span class="si">{0:d}</span><span class="s2">])&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_size_reg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ALIGN_WR_PTR</span><span class="p">,</span> <span class="s2">&quot;log_block_size&quot;</span><span class="p">,</span>
                    <span class="n">log_block_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
            <span class="n">imm_value</span> <span class="o">=</span> <span class="n">log_block_size</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; align(</span><span class="si">{0:d}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">imm_value</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ALIGN_WR_PTR</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">bit_field</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">return_register_value</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">block_size_reg</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">imm_value</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.call_arithmetic_operation"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.call_arithmetic_operation">[docs]</a>    <span class="k">def</span> <span class="nf">call_arithmetic_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span>
                                  <span class="n">operand_2</span><span class="p">,</span> <span class="n">signed</span><span class="p">,</span>
                                  <span class="n">operand_1_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">operand_2_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to perform an arithmetic operation on two signed or\</span>
<span class="sd">            unsigned values and store the result in a register</span>

<span class="sd">        :param int register_id: The ID of the register to store the result in</span>
<span class="sd">        :param int operand_1:</span>
<span class="sd">            * If ``operand_1_is_register`` is True, the ID of a register where</span>
<span class="sd">              the first operand can be found, between 0 and 15</span>
<span class="sd">            * If ``operand_1_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param ArithmeticOperation operation: The operation to perform</span>
<span class="sd">        :param int operand_2:</span>
<span class="sd">            * If ``operand_2_is_register`` is True, the ID of a register where</span>
<span class="sd">              the second operand can be found, between 0 and 15</span>
<span class="sd">            * If ``operand_2_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param bool signed: Indicates if the values should be considered signed</span>
<span class="sd">        :param bool operand_1_is_register:</span>
<span class="sd">            Indicates if ``operand_1`` is a register ID</span>
<span class="sd">        :param bool operand_2_is_register:</span>
<span class="sd">            Indicates if ``operand_2`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``register_id`` is not a valid register ID</span>
<span class="sd">            * If ``operand_1_is_register`` is True and ``operand_1`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">            * If ``operand_2_is_register`` is True and ``operand_2`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">        :raise InvalidOperationException:</span>
<span class="sd">            If ``operation`` is not a known operation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ARITH_OP</span><span class="p">,</span> <span class="s2">&quot;register_id&quot;</span><span class="p">,</span>
                <span class="n">register_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ArithmeticOperation</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidOperationException</span><span class="p">(</span>
                <span class="s2">&quot;arithmetic&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">ARITH_OP</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bit_field</span> <span class="o">=</span> <span class="mh">0x4</span>
        <span class="n">register_op_1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">register_op_2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">encoded_operands</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">ARITH_OP</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{0:s}</span><span class="s2"> reg[</span><span class="si">{1:d}</span><span class="s2">] =&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;SIGNED&quot;</span> <span class="k">if</span> <span class="n">signed</span> <span class="k">else</span> <span class="s2">&quot;UNSIGNED&quot;</span><span class="p">,</span> <span class="n">register_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">operand_1_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ARITH_OP</span><span class="p">,</span> <span class="s2">&quot;operand_1&quot;</span><span class="p">,</span>
                    <span class="n">operand_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="mi">2</span>
            <span class="n">register_op_1</span> <span class="o">=</span> <span class="n">operand_1</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register_op_1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">signed</span><span class="p">:</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ARITH_OP</span><span class="p">,</span> <span class="s2">&quot;operand_1&quot;</span><span class="p">,</span>
                        <span class="n">operand_1</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>
            <span class="n">cmd_length</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">encoded_operands</span> <span class="o">+=</span> <span class="n">_ONE_SIGNED_INT</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">operand_1</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operand_1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ARITH_OP</span><span class="p">,</span> <span class="s2">&quot;operand_1&quot;</span><span class="p">,</span>
                        <span class="n">operand_1</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">)</span>
            <span class="n">cmd_length</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">encoded_operands</span> <span class="o">+=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">operand_1</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operand_1</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">operation</span><span class="o">.</span><span class="n">operator</span>

        <span class="k">if</span> <span class="n">operand_2_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ARITH_OP</span><span class="p">,</span> <span class="s2">&quot;operand_2&quot;</span><span class="p">,</span>
                    <span class="n">operand_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="mi">1</span>
            <span class="n">register_op_2</span> <span class="o">=</span> <span class="n">operand_2</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register_op_2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">signed</span><span class="p">:</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ARITH_OP</span><span class="p">,</span> <span class="s2">&quot;operand_2&quot;</span><span class="p">,</span>
                        <span class="n">operand_2</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>
            <span class="n">cmd_length</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">encoded_operands</span> <span class="o">+=</span> <span class="n">_ONE_SIGNED_INT</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">operand_2</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operand_2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ARITH_OP</span><span class="p">,</span> <span class="s2">&quot;operand_2&quot;</span><span class="p">,</span>
                        <span class="n">operand_2</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">)</span>
            <span class="n">cmd_length</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">encoded_operands</span> <span class="o">+=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">operand_2</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operand_2</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">ARITH_OP</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">cmd_length</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SIGNED</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">signed</span><span class="p">),</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">bit_field</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">register_id</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">register_op_1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_2</span><span class="p">:</span> <span class="n">register_op_2</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">operation</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">encoded_operands</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.logical_and"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.logical_and">[docs]</a>    <span class="k">def</span> <span class="nf">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">operand_2</span><span class="p">,</span>
                    <span class="n">operand_1_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">operand_2_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to perform a logical AND operation.</span>

<span class="sd">        :param int register_id: The ID of the register to store the result in</span>
<span class="sd">        :param int operand_1:</span>
<span class="sd">            * If ``operand_1_is_register`` is True, the ID of a register</span>
<span class="sd">              where the first operand can be found, between 0 and 15</span>
<span class="sd">            * If ``operand_1_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param int operand_2:</span>
<span class="sd">            * If ``operand_2_is_register`` is True, the ID of a register</span>
<span class="sd">              where the second operand can be found. between 0 and 15</span>
<span class="sd">            * If ``operand_2_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param bool operand_1_is_register:</span>
<span class="sd">            Indicates if ``operand_1`` is a register ID</span>
<span class="sd">        :param bool operand_2_is_register:</span>
<span class="sd">            Indicates if ``operand_2`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``register_id`` is not a valid register ID</span>
<span class="sd">            * If ``operand_1_is_register`` is True and ``operand_1`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">            * If ``operand_2_is_register`` is True and ``operand_2`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_logic_operation</span><span class="p">(</span>
            <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">LogicOperation</span><span class="o">.</span><span class="n">AND</span><span class="p">,</span> <span class="n">operand_2</span><span class="p">,</span>
            <span class="n">operand_1_is_register</span><span class="p">,</span> <span class="n">operand_2_is_register</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.logical_or"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.logical_or">[docs]</a>    <span class="k">def</span> <span class="nf">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">operand_2</span><span class="p">,</span>
                   <span class="n">operand_1_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">operand_2_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to perform a logical OR operation.</span>

<span class="sd">        :param int register_id: The ID of the register to store the result in</span>
<span class="sd">        :param int operand_1:</span>
<span class="sd">            * If ``operand_1_is_register`` is True, the ID of a register</span>
<span class="sd">              where the first operand can be found, between 0 and 15</span>
<span class="sd">            * If ``operand_1_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param int operand_2:</span>
<span class="sd">            * If ``operand_2_is_register`` is True, the ID of a register</span>
<span class="sd">              where the second operand can be found. between 0 and 15</span>
<span class="sd">            * If ``operand_2_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param bool operand_1_is_register:</span>
<span class="sd">            Indicates if ``operand_1`` is a register ID</span>
<span class="sd">        :param bool operand_2_is_register:</span>
<span class="sd">            Indicates if ``operand_2`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``register_id`` is not a valid register ID</span>
<span class="sd">            * If ``operand_1_is_register`` is True and ``operand_1`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">            * If ``operand_2_is_register`` is True and ``operand_2`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_logic_operation</span><span class="p">(</span>
            <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">LogicOperation</span><span class="o">.</span><span class="n">OR</span><span class="p">,</span> <span class="n">operand_2</span><span class="p">,</span>
            <span class="n">operand_1_is_register</span><span class="p">,</span> <span class="n">operand_2_is_register</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.logical_left_shift"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.logical_left_shift">[docs]</a>    <span class="k">def</span> <span class="nf">logical_left_shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">operand_2</span><span class="p">,</span>
                           <span class="n">operand_1_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">operand_2_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to perform a logical left shift operation.</span>

<span class="sd">        :param int register_id: The ID of the register to store the result in</span>
<span class="sd">        :param int operand_1:</span>
<span class="sd">            * If ``operand_1_is_register`` is True, the ID of a register</span>
<span class="sd">              where the first operand can be found, between 0 and 15</span>
<span class="sd">            * If ``operand_1_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param int operand_2:</span>
<span class="sd">            * If ``operand_2_is_register`` is True, the ID of a register</span>
<span class="sd">              where the second operand can be found. between 0 and 15</span>
<span class="sd">            * If ``operand_2_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param bool operand_1_is_register:</span>
<span class="sd">            Indicates if ``operand_1`` is a register ID</span>
<span class="sd">        :param bool operand_2_is_register:</span>
<span class="sd">            Indicates if ``operand_2`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``register_id`` is not a valid register ID</span>
<span class="sd">            * If ``operand_1_is_register`` is True and ``operand_1`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">            * If ``operand_2_is_register`` is True and ``operand_2`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_logic_operation</span><span class="p">(</span>
            <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">LogicOperation</span><span class="o">.</span><span class="n">LEFT_SHIFT</span><span class="p">,</span> <span class="n">operand_2</span><span class="p">,</span>
            <span class="n">operand_1_is_register</span><span class="p">,</span> <span class="n">operand_2_is_register</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.logical_right_shift"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.logical_right_shift">[docs]</a>    <span class="k">def</span> <span class="nf">logical_right_shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">operand_2</span><span class="p">,</span>
                            <span class="n">operand_1_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">operand_2_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to perform a logical right shift operation.</span>

<span class="sd">        :param int register_id: The ID of the register to store the result in</span>
<span class="sd">        :param int operand_1:</span>
<span class="sd">            * If ``operand_1_is_register`` is True, the ID of a register</span>
<span class="sd">              where the first operand can be found, between 0 and 15</span>
<span class="sd">            * If ``operand_1_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param int operand_2:</span>
<span class="sd">            * If ``operand_2_is_register`` is True, the ID of a register</span>
<span class="sd">              where the second operand can be found. between 0 and 15</span>
<span class="sd">            * If ``operand_2_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param bool operand_1_is_register:</span>
<span class="sd">            Indicates if ``operand_1`` is a register ID</span>
<span class="sd">        :param bool operand_2_is_register:</span>
<span class="sd">            Indicates if ``operand_2`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``register_id`` is not a valid register ID</span>
<span class="sd">            * If ``operand_1_is_register`` is True and ``operand_1`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">            * If ``operand_2_is_register`` is True and ``operand_2`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_logic_operation</span><span class="p">(</span>
            <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">LogicOperation</span><span class="o">.</span><span class="n">RIGHT_SHIFT</span><span class="p">,</span> <span class="n">operand_2</span><span class="p">,</span>
            <span class="n">operand_1_is_register</span><span class="p">,</span> <span class="n">operand_2_is_register</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.logical_xor"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.logical_xor">[docs]</a>    <span class="k">def</span> <span class="nf">logical_xor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">operand_2</span><span class="p">,</span>
                    <span class="n">operand_1_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">operand_2_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to perform a logical xor operation.</span>

<span class="sd">        :param int register_id: The ID of the register to store the result in</span>
<span class="sd">        :param int operand_1:</span>
<span class="sd">            * If ``operand_1_is_register`` is True, the ID of a register</span>
<span class="sd">              where the first operand can be found, between 0 and 15</span>
<span class="sd">            * If ``operand_1_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param int operand_2:</span>
<span class="sd">            * If ``operand_2_is_register`` is True, the ID of a register</span>
<span class="sd">              where the second operand can be found. between 0 and 15</span>
<span class="sd">            * If ``operand_2_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param bool operand_1_is_register:</span>
<span class="sd">            Indicates if ``operand_1`` is a register ID</span>
<span class="sd">        :param bool operand_2_is_register:</span>
<span class="sd">            Indicates if ``operand_2`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``register_id`` is not a valid register ID</span>
<span class="sd">            * If ``operand_1_is_register`` is True and ``operand_1`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">            * If ``operand_2_is_register`` is True and ``operand_2`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_logic_operation</span><span class="p">(</span>
            <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">LogicOperation</span><span class="o">.</span><span class="n">XOR</span><span class="p">,</span> <span class="n">operand_2</span><span class="p">,</span>
            <span class="n">operand_1_is_register</span><span class="p">,</span> <span class="n">operand_2_is_register</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.logical_not"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.logical_not">[docs]</a>    <span class="k">def</span> <span class="nf">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">operand_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to perform a logical not operation.</span>

<span class="sd">        :param int register_id: The ID of the register to store the result in</span>
<span class="sd">        :param int operand:</span>
<span class="sd">            * If ``operand_is_register`` is True, the ID of a register where</span>
<span class="sd">              the first operand can be found, between 0 and 15</span>
<span class="sd">            * If ``operand_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param bool operand_is_register:</span>
<span class="sd">            Indicates if ``operand`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``register_id`` is not a valid register ID</span>
<span class="sd">            * If ``operand_is_register`` is True and ``operand`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_logic_operation</span><span class="p">(</span>
            <span class="n">register_id</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">LogicOperation</span><span class="o">.</span><span class="n">NOT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">operand_is_register</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_call_logic_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_id</span><span class="p">,</span> <span class="n">operand_1</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span>
                              <span class="n">operand_2</span><span class="p">,</span> <span class="n">operand_1_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">operand_2_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to perform a logic operation on two signed or\</span>
<span class="sd">            unsigned values and store the result in a register</span>

<span class="sd">        :param int register_id: The ID of the register to store the result in</span>
<span class="sd">        :param int operand_1:</span>
<span class="sd">            * If ``operand_1_is_register`` is True, the ID of a register</span>
<span class="sd">              where the first operand can be found, between 0 and 15</span>
<span class="sd">            * If ``operand_1_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param LogicOperation operation: The operation to perform</span>
<span class="sd">        :param int operand_2:</span>
<span class="sd">            * If ``operand_2_is_register`` is True, the ID of a register</span>
<span class="sd">              where the second operand can be found. between 0 and 15</span>
<span class="sd">            * If ``operand_2_is_register`` is False, a 32-bit value</span>
<span class="sd">        :param bool operand_1_is_register:</span>
<span class="sd">            Indicates if ``operand_1`` is a register ID</span>
<span class="sd">        :param bool operand_2_is_register:</span>
<span class="sd">            Indicates if ``operand_2`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``register_id`` is not a valid register ID</span>
<span class="sd">            * If ``operand_1_is_register`` is True and ``operand_1`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">            * If ``operand_2_is_register`` is True and ``operand_2`` is not a</span>
<span class="sd">              valid register ID</span>
<span class="sd">        :raise InvalidOperationException:</span>
<span class="sd">            If ``operation`` is not a known operation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOGIC_OP</span><span class="p">,</span> <span class="s2">&quot;register_id&quot;</span><span class="p">,</span>
                <span class="n">register_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">LogicOperation</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidOperationException</span><span class="p">(</span>
                <span class="s2">&quot;logic&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">LOGIC_OP</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bit_field</span> <span class="o">=</span> <span class="mh">0x4</span>
        <span class="n">register_op_1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">register_op_2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">encoded_operands</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">LOGIC_OP</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">] =&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">LogicOperation</span><span class="o">.</span><span class="n">NOT</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">operation</span><span class="o">.</span><span class="n">operator</span>

        <span class="k">if</span> <span class="n">operand_1_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOGIC_OP</span><span class="p">,</span> <span class="s2">&quot;operand_1&quot;</span><span class="p">,</span>
                    <span class="n">operand_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="mi">2</span>
            <span class="n">register_op_1</span> <span class="o">=</span> <span class="n">operand_1</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register_op_1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd_length</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOGIC_OP</span><span class="p">,</span> <span class="s2">&quot;operand_1&quot;</span><span class="p">,</span>
                        <span class="n">operand_1</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">)</span>
            <span class="n">encoded_operands</span> <span class="o">+=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">operand_1</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">operand_1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">LogicOperation</span><span class="o">.</span><span class="n">NOT</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">operation</span><span class="o">.</span><span class="n">operator</span>
            <span class="k">if</span> <span class="n">operand_2_is_register</span><span class="p">:</span>
                <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOGIC_OP</span><span class="p">,</span> <span class="s2">&quot;operand_2&quot;</span><span class="p">,</span>
                        <span class="n">operand_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
                <span class="n">bit_field</span> <span class="o">|=</span> <span class="mi">1</span>
                <span class="n">register_op_2</span> <span class="o">=</span> <span class="n">operand_2</span>
                <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register_op_2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd_length</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOGIC_OP</span><span class="p">,</span> <span class="s2">&quot;operand_2&quot;</span><span class="p">,</span>
                            <span class="n">operand_2</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">)</span>
                <span class="n">encoded_operands</span> <span class="o">+=</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">operand_2</span><span class="p">)</span>
                <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">operand_2</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">LOGIC_OP</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">cmd_length</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">bit_field</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">register_id</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">register_op_1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_2</span><span class="p">:</span> <span class="n">register_op_2</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">operation</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">encoded_operands</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span>

<div class="viewcode-block" id="DataSpecificationGenerator.copy_structure"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.copy_structure">[docs]</a>    <span class="k">def</span> <span class="nf">copy_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_structure_id</span><span class="p">,</span> <span class="n">destination_structure_id</span><span class="p">,</span>
                       <span class="n">source_id_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">destination_id_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to copy a structure, possibly overwriting another\</span>
<span class="sd">            structure</span>

<span class="sd">        :param int source_structure_id:</span>
<span class="sd">            * If ``source_id_is_register`` is True, the ID of the register</span>
<span class="sd">              holding the source structure ID, between 0 and 15</span>
<span class="sd">            * Otherwise, the ID of the source structure, between 0 and 15</span>
<span class="sd">        :param int destination_structure_id:</span>
<span class="sd">            * If ``destination_id_is_register`` is True, the ID of the</span>
<span class="sd">              register holding the destination structure ID, between 0 and 15</span>
<span class="sd">            * If ``destination_id_is_register`` is False, the ID of the</span>
<span class="sd">              destination structure, between 0 and 15</span>
<span class="sd">        :param bool source_id_is_register:</span>
<span class="sd">            Indicates if ``source_structure_id`` is a register ID</span>
<span class="sd">        :param bool destination_id_is_register:</span>
<span class="sd">            Indicates if ``destination_structure_id`` is a register ID</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``source_id_is_register`` is True and</span>
<span class="sd">              ``source_structure_id`` is not a valid register ID</span>
<span class="sd">            * If ``destination_id_is_register`` is True and</span>
<span class="sd">              ``destination_structure_id`` is not a valid register ID</span>
<span class="sd">            * If ``source_id_is_register`` is False and</span>
<span class="sd">              ``source_structure_id`` is not a valid structure ID</span>
<span class="sd">            * If ``destination_id_is_register`` is False and</span>
<span class="sd">              ``destination_structure_id`` is not a valid structure ID</span>
<span class="sd">        :raise NotAllocatedException:</span>
<span class="sd">            * If no structure with ID ``source_structure_id`` has been</span>
<span class="sd">              allocated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">source_structure_id</span> <span class="o">==</span> <span class="n">destination_structure_id</span> <span class="ow">and</span> \
                <span class="n">destination_id_is_register</span> <span class="o">==</span> <span class="n">source_id_is_register</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DuplicateParameterException</span><span class="p">(</span>
                <span class="n">Commands</span><span class="o">.</span><span class="n">COPY_STRUCT</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">[</span><span class="n">source_structure_id</span><span class="p">,</span> <span class="n">destination_structure_id</span><span class="p">])</span>

        <span class="n">bit_field</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">COPY_STRUCT</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">source_id_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_STRUCT</span><span class="p">,</span> <span class="s2">&quot;source_structure_id&quot;</span><span class="p">,</span>
                    <span class="n">source_structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="n">SRC1_ONLY</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; source_struct=reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">source_structure_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_STRUCT</span><span class="p">,</span> <span class="s2">&quot;source_structure_id&quot;</span><span class="p">,</span>
                    <span class="n">source_structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">source_structure_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                    <span class="s2">&quot;struct&quot;</span><span class="p">,</span> <span class="n">source_structure_id</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">COPY_STRUCT</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; source_struct=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_structure_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">destination_id_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_STRUCT</span><span class="p">,</span> <span class="s2">&quot;destination_structure_id&quot;</span><span class="p">,</span>
                    <span class="n">destination_structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="n">DEST_ONLY</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; destination_struct=reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">destination_structure_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_STRUCT</span><span class="p">,</span> <span class="s2">&quot;destination_structure_id&quot;</span><span class="p">,</span>
                    <span class="n">destination_structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; destination_struct=</span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">destination_structure_id</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_STRUCT</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">bit_field</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">destination_structure_id</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">source_structure_id</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.copy_structure_parameter"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.copy_structure_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">copy_structure_parameter</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">source_structure_id</span><span class="p">,</span> <span class="n">source_parameter_index</span><span class="p">,</span>
            <span class="n">destination_id</span><span class="p">,</span> <span class="n">destination_parameter_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">destination_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to copy the value of a parameter from one\</span>
<span class="sd">            structure to another.</span>

<span class="sd">        :param int source_structure_id:</span>
<span class="sd">            The ID of the source structure, between 0 and 15</span>
<span class="sd">        :param int source_parameter_index:</span>
<span class="sd">            The index of the parameter in the source structure</span>
<span class="sd">        :param int destination_id: The ID of the destination structure, or</span>
<span class="sd">            the ID of the destination register, between 0 and 15</span>
<span class="sd">        :param int destination_parameter_index: The index of the parameter in</span>
<span class="sd">            the destination structure. Ignored when writing to a register.</span>
<span class="sd">        :param bool destination_is_register:</span>
<span class="sd">            Indicates whether the destination is a structure or a register.</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``source_structure_id`` is not a valid structure ID</span>
<span class="sd">            * If ``destination_id`` is not a valid structure ID</span>
<span class="sd">            * If ``source_parameter_index`` is not a valid parameter index</span>
<span class="sd">              in the source structure</span>
<span class="sd">            * If ``destination_parameter_index`` is not a valid parameter</span>
<span class="sd">              index in the destination structure</span>
<span class="sd">        :raise NotAllocatedException:</span>
<span class="sd">            * If no structure with ID ``destination_id`` has been allocated</span>
<span class="sd">            * If no structure with ID ``source_structure_id`` has been</span>
<span class="sd">              allocated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="p">,</span> <span class="s2">&quot;source_structure_id&quot;</span><span class="p">,</span>
                <span class="n">source_structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="p">,</span> <span class="s2">&quot;source_parameter_index&quot;</span><span class="p">,</span>
                <span class="n">source_parameter_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_ELEMENTS</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">source_structure_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="n">source_structure_id</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">source_structure_id</span><span class="p">])</span> <span class="o">&lt;=</span>
                <span class="n">source_parameter_index</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                <span class="s2">&quot;parameter&quot;</span><span class="p">,</span> <span class="n">source_parameter_index</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">destination_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="p">,</span> <span class="s2">&quot;destination_parameter_index&quot;</span><span class="p">,</span>
                    <span class="n">destination_parameter_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_ELEMENTS</span><span class="p">)</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="p">,</span> <span class="s2">&quot;destination_structure_id&quot;</span><span class="p">,</span>
                    <span class="n">destination_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">destination_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                    <span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">source_structure_id</span><span class="p">])</span> <span class="o">&lt;=</span>
                    <span class="n">source_parameter_index</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                    <span class="s2">&quot;parameter&quot;</span><span class="p">,</span> <span class="n">destination_parameter_index</span><span class="p">,</span>
                    <span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">destination_id</span><span class="p">])</span> <span class="o">&lt;=</span>
                    <span class="n">destination_parameter_index</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                    <span class="s2">&quot;parameter&quot;</span><span class="p">,</span> <span class="n">destination_parameter_index</span><span class="p">,</span>
                    <span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">source_structure_id</span><span class="p">]</span>
                    <span class="p">[</span><span class="n">source_parameter_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">destination_id</span><span class="p">]</span>
                    <span class="p">[</span><span class="n">destination_parameter_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="n">TypeMismatchException</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">source_structure_id</span> <span class="o">==</span> <span class="n">destination_id</span> <span class="ow">and</span>
                    <span class="n">destination_parameter_index</span> <span class="o">==</span> <span class="n">source_parameter_index</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">DuplicateParameterException</span><span class="p">(</span>
                    <span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span>
                        <span class="n">source_structure_id</span><span class="p">,</span> <span class="n">source_parameter_index</span><span class="p">,</span>
                        <span class="n">destination_id</span><span class="p">,</span> <span class="n">destination_parameter_index</span><span class="p">])</span>

            <span class="n">cmd_word_1</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN2</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">NO_REGS</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">destination_id</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">source_structure_id</span><span class="p">})</span>
            <span class="n">param_word</span> <span class="o">=</span> <span class="p">((</span><span class="n">destination_parameter_index</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
                          <span class="n">source_parameter_index</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot; source_structure_id = </span><span class="si">{0:d}</span><span class="s2">, source_parameter_id = </span><span class="si">{1:d}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;destination_structure_id = </span><span class="si">{2:d}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;destination_parameter_id = </span><span class="si">{3:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">source_structure_id</span><span class="p">,</span> <span class="n">source_parameter_index</span><span class="p">,</span>
                    <span class="n">destination_id</span><span class="p">,</span> <span class="n">destination_parameter_index</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="p">,</span> <span class="s2">&quot;destination_register_id&quot;</span><span class="p">,</span>
                    <span class="n">destination_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>

            <span class="n">cmd_word_1</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">COPY_PARAM</span><span class="p">,</span> <span class="p">{</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN2</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">DEST_ONLY</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">:</span> <span class="n">destination_id</span><span class="p">,</span>
                <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">source_structure_id</span><span class="p">})</span>
            <span class="n">param_word</span> <span class="o">=</span> <span class="n">source_parameter_index</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot; source_structure_id = </span><span class="si">{0:d}</span><span class="s2">, source_parameter_id = </span><span class="si">{1:d}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;destination_register_id = </span><span class="si">{2:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">source_structure_id</span><span class="p">,</span> <span class="n">source_parameter_index</span><span class="p">,</span>
                    <span class="n">destination_id</span><span class="p">))</span>

        <span class="n">cmd_word_list</span> <span class="o">=</span> <span class="n">cmd_word_1</span> <span class="o">+</span> <span class="n">_ONE_WORD</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">param_word</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word_list</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.print_value"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.print_value">[docs]</a>    <span class="k">def</span> <span class="nf">print_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">value_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to print out a value (for debugging)</span>

<span class="sd">        :param value:</span>
<span class="sd">            * If ``value_is_register`` is True, the ID of the register</span>
<span class="sd">              containing the value to print</span>
<span class="sd">            * If ``value_is_register`` is False, the value to print as a</span>
<span class="sd">              value of type given by ``data_type``</span>
<span class="sd">        :type value: float or int</span>
<span class="sd">        :param bool value_is_register: Indicates if ``value`` is a register</span>
<span class="sd">        :param DataType data_type: The type of the data to be printed</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``value_is_register`` is True and ``value`` is not a valid</span>
<span class="sd">              register ID</span>
<span class="sd">            * If ``value_is_register`` is False, the ``data_type`` is an</span>
<span class="sd">              integer type and ``value`` has a fractional part</span>
<span class="sd">            * If ``value_is_register`` is False and the ``value`` would</span>
<span class="sd">              overflow the data type</span>
<span class="sd">        :raise UnknownTypeException: If ``data_type`` is not a valid data type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source_register_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bit_field</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">data_encoded</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_VAL</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">value_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_VAL</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">cmd_word_length</span> <span class="o">=</span> <span class="n">LEN1</span>
            <span class="n">bit_field</span> <span class="o">|=</span> <span class="mi">2</span>
            <span class="n">source_register_id</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; reg[</span><span class="si">{0:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_register_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_typebounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_VAL</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>
            <span class="n">cmd_word_length</span> <span class="o">=</span> <span class="n">LEN2</span> <span class="k">if</span> <span class="n">data_type</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">else</span> <span class="n">LEN3</span>
            <span class="n">data_encoded</span> <span class="o">+=</span> <span class="n">data_type</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_VAL</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">cmd_word_length</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">bit_field</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">source_register_id</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">data_type</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">data_encoded</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.print_text"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.print_text">[docs]</a>    <span class="k">def</span> <span class="nf">print_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;ASCII&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to print some text (for debugging)</span>

<span class="sd">        :param str text: The text to write (max 12 *bytes* once encoded)</span>
<span class="sd">        :param str encoding:</span>
<span class="sd">            The character encoding to use for the string. Defaults to ASCII.</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text_encoded</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">))</span>
        <span class="n">text_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_encoded</span><span class="p">)</span>
        <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_TXT</span><span class="p">,</span> <span class="s2">&quot;len(text)&quot;</span><span class="p">,</span> <span class="n">text_len</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">text_len</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">cmd_word_len</span> <span class="o">=</span> <span class="n">LEN2</span>
        <span class="k">elif</span> <span class="n">text_len</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">cmd_word_len</span> <span class="o">=</span> <span class="n">LEN3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd_word_len</span> <span class="o">=</span> <span class="n">LEN4</span>

        <span class="c1"># add final padding to the encoded text</span>
        <span class="k">if</span> <span class="n">text_len</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">text_encoded</span> <span class="o">+=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">text_len</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_TXT</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="se">\&quot;</span><span class="si">{0:s}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_TXT</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">cmd_word_len</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">text_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">text_encoded</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.print_struct"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.print_struct">[docs]</a>    <span class="k">def</span> <span class="nf">print_struct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">,</span> <span class="n">structure_id_is_register</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert command to print out a structure (for debugging)</span>

<span class="sd">        :param int structure_id:</span>
<span class="sd">            * If ``structure_id_is_register`` is True, the ID of the register</span>
<span class="sd">              containing the ID of the structure to print, between 0 and 15</span>
<span class="sd">            * If ``structure_id_is_register`` is False, the ID of the</span>
<span class="sd">              structure to print, between 0 and 15</span>
<span class="sd">        :param bool structure_id_is_register:</span>
<span class="sd">            Indicates if the ``structure_id`` is a register</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        :raise ParameterOutOfBoundsException:</span>
<span class="sd">            * If ``structure_id_is_register`` is True and ``structure_id`` is</span>
<span class="sd">              not a valid register ID</span>
<span class="sd">            * If ``structure_id_is_register`` is False and ``structure_id``</span>
<span class="sd">              is not a valid structure ID</span>
<span class="sd">        :raise NotAllocatedException:</span>
<span class="sd">            If ``structure_id_is_register`` is False and ``structure_id`` is</span>
<span class="sd">            the ID of a structure that has not been allocated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_STRUCT</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">structure_id_is_register</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_STRUCT</span><span class="p">,</span> <span class="s2">&quot;structure_id&quot;</span><span class="p">,</span>
                    <span class="n">structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_REGISTERS</span><span class="p">)</span>
            <span class="n">struct_register</span> <span class="o">=</span> <span class="n">structure_id</span>
            <span class="n">structure_id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">bit_field</span> <span class="o">=</span> <span class="mh">0x2</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; struct(reg[</span><span class="si">{0:d}</span><span class="s2">])&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">struct_register</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_bounds</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_STRUCT</span><span class="p">,</span> <span class="s2">&quot;structure_id&quot;</span><span class="p">,</span>
                    <span class="n">structure_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MAX_STRUCT_SLOTS</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct_slots</span><span class="p">[</span><span class="n">structure_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotAllocatedException</span><span class="p">(</span>
                    <span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="n">structure_id</span><span class="p">,</span> <span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_STRUCT</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">struct_register</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">bit_field</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cmd_string</span> <span class="o">+=</span> <span class="s2">&quot; struct(</span><span class="si">{0:d}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">structure_id</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">PRINT_STRUCT</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">USAGE</span><span class="p">:</span> <span class="n">bit_field</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">SOURCE_1</span><span class="p">:</span> <span class="n">struct_register</span><span class="p">,</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span> <span class="n">structure_id</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSpecificationGenerator.end_specification"><a class="viewcode-back" href="../../index.html#data_specification.DataSpecificationGenerator.end_specification">[docs]</a>    <span class="k">def</span> <span class="nf">end_specification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">close_writer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Insert a command to indicate that the specification has finished\</span>
<span class="sd">            and finish writing</span>

<span class="sd">        :param bool close_writer:</span>
<span class="sd">            Indicates whether to close the underlying writer(s)</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">End of specification:&quot;</span><span class="p">)</span>

        <span class="n">cmd_word</span> <span class="o">=</span> <span class="n">_binencode</span><span class="p">(</span><span class="n">Commands</span><span class="o">.</span><span class="n">END_SPEC</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">_Field</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">:</span> <span class="n">LEN1</span><span class="p">})</span>
        <span class="n">encoded_parameter</span> <span class="o">=</span> <span class="n">_ONE_SIGNED_INT</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cmd_string</span> <span class="o">=</span> <span class="n">Commands</span><span class="o">.</span><span class="n">END_SPEC</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_command_to_files</span><span class="p">(</span><span class="n">cmd_word</span> <span class="o">+</span> <span class="n">encoded_parameter</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_writer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spec_writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spec_writer</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_report_writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_report_writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_report_writer</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_write_command_to_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd_word_list</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">outdent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">no_instruction_number</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Writes the binary command to the binary output file and, if the\</span>
<span class="sd">            user has requested a text output for debug purposes, also write\</span>
<span class="sd">            the text version to the text file.</span>

<span class="sd">        Setting the optional parameter ``indent`` to ``True`` causes subsequent</span>
<span class="sd">        commands to be indented by two spaces relative to this one. Similarly,</span>
<span class="sd">        setting ``outdent`` to ``True`` reverses this spacing.</span>

<span class="sd">        :param bytearray cmd_word_list: list of binary words to be added to</span>
<span class="sd">            the binary data specification file</span>
<span class="sd">        :param str cmd_string: string describing the command to be added to</span>
<span class="sd">            the report for the data specification file</span>
<span class="sd">        :param bool indent: if the following lines need to be indented</span>
<span class="sd">        :param bool outdent: if the following lines need to be out-dented</span>
<span class="sd">        :param bool no_instruction_number: if each report line should include</span>
<span class="sd">            also the address of the command in the file</span>
<span class="sd">        :raise DataUndefinedWriterException:</span>
<span class="sd">            If the binary specification file writer has not been initialised</span>
<span class="sd">        :raise IOError: If a write to external storage fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spec_writer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataUndefinedWriterException</span><span class="p">(</span>
                <span class="s2">&quot;The spec file writer has not been initialised&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cmd_word_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spec_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd_word_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_report_writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">outdent</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txt_indent</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txt_indent</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">indent_string</span> <span class="o">=</span> <span class="s2">&quot;   &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txt_indent</span>
            <span class="k">if</span> <span class="n">no_instruction_number</span><span class="p">:</span>
                <span class="n">formatted_cmd_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">indent_string</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">formatted_cmd_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:08X}</span><span class="s2">. </span><span class="si">{}{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_instruction_counter</span><span class="p">,</span> <span class="n">indent_string</span><span class="p">,</span> <span class="n">cmd_string</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_instruction_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmd_word_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">formatted_cmd_string</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">indent</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txt_indent</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">region_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A list of sizes of each region that has been reserved.</span>

<span class="sd">        .. note::</span>
<span class="sd">            The list will include ``0`` for each non-reserved region.</span>

<span class="sd">        :rtype: list(int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">slot</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">slot</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mem_slots</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The ID of the current DSG region we&#39;re writing to.\</span>
<span class="sd">            If not yet writing to any region, ``None``.</span>

<span class="sd">        :rtype: int or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_region</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">DataSpecification 6.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">data_specification.data_specification_generator</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014-2021.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>